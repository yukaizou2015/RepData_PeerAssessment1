---
title: "Reproducible Research: Peer Assessment 1"
author: Yukai Zou
date: "11 November 2015"
output: 
  html_document:
    keep_md: true
---

## Loading and preprocessing the data

We begin with setting the working directory and loading the data:
```{r}
setwd("~/Desktop/Data Sciences Specialization/Reproducible Research/RepData_PeerAssessment1/")
activity <- read.csv("activity.csv", stringsAsFactors=FALSE)
head(activity)
```


## What is mean total number of steps taken per day?

To answer the question, first we need to calculate the total number of steps taken per day:
```{r}
ans1 <- tapply(activity$steps, activity$date, sum)
ans1
```
We can make histogram to look at the distribution:
```{r}
par(mar = c(4, 4, 2, 2))
hist(ans1, main = "Distribution of the total number of steps taken each day",
     xlab = "Number of steps")
```

Seems that the majority lies between 10000 and 15000. We then calculated the mean and median of the total number of steps taken per day.
```{r}
c(mean = mean(ans1, na.rm=TRUE), median = median(ans1, na.rm=TRUE))
```
The median is slightly lower than the mean value, but these numbers are consistent with what we observed in the histogram.


## What is the average daily activity pattern?

To answer this question, a line graph will be intuitive to demonstrate. We first averaged the number of steps, ignoring all the missing values, within each interval; then we plotted a time-series diagram with the 5-minute interval as x axis and the averaged number as y-axis.
```{r}
ans2 <- tapply(activity$steps, activity$interval, function(x) mean(x, na.rm=TRUE))
plot(ans2, type="l", xlab = "Index of interval", ylab = "Averaged number of steps",
     main = "Averaged steps in each 5-minute interval")
# how to save a figure with customized size?
```

Based on the time-series plot, a peak was identified around the 100th interval. We then applied `which()` to find which index the peak value corresponds to:
```{r}
c(interval = names(which(ans2 == max(ans2))), index = as.numeric(which(ans2 == max(ans2))))
```
Therefore, we found that on average across all the days, the maximum number of steps was recorded at the **104th** interval, from **835** to **840 minutes**.

## Imputing missing values

We suspected that the presence of missing values (e.g. missing days/intervals) may introduce bias in our calculations and summaries, therefore, it is necessary to impute these missing values. First, we wanted to know how many missing values in total are there within the dataset:
```{r}
dim(activity[is.na(activity$steps),])[1]
```
That's quite a few missing data! 
2. The mean of each 5-minute interval is used to fill in all of the missing values in the dataset. 
3. A new dataset is created which contains the same original dataset but with the missing data filled in.
```{r}
activity2 <- activity
activity2[is.na(activity2$steps),]$steps <- ans2
head(activity2)
# Can the code be improved?
```
4. Make a histogram of the total number of steps taken each day and calculate and report the mean and median total number of steps taken per day. Do these values differ from the estimates from the first part of the assignment? What is the impact of imputing missing data on the estimates of the total daily number of steps?
```{r}
ans3 <- tapply(activity2$steps, activity2$date, sum)
hist(ans3)
c(mean = mean(ans3), median = median(ans3))
```
Imputing missing data did not change the mean, but the median was changed.


## Are there differences in activity patterns between weekdays and weekends?

1. A new factor variable was added to the dataset, indicating whether a given date is a weekday or weekend day.
```{r}
library(dplyr)
activity2$date <- as.Date(activity2$date)
activity2 <- mutate(activity2, daytype = factor(1 * (weekdays(date) == "Saturday" | weekdays(date) == "Sunday"), labels = c("weekday", "weekend")))
```
2. Make a panel plot containing a time series plot of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all weekday days or weekend days (y-axis). See the README file in the GitHub repository to see an example of what this plot should look like using simulated data.
```{r}
weekday <- split(activity2, activity2$daytype)[[1]]
weekend <- split(activity2, activity2$daytype)[[2]]
weekday.avg <- tapply(weekday$steps, weekday$interval, mean)
weekend.avg <- tapply(weekend$steps, weekend$interval, mean)
plot(weekday.avg, type="l", col = "red")
lines(weekend.avg, col = "blue")
# add a legend, showing red as weekday, blue as weekend
```